# sht-webedit  
一款用于编辑东方Project游戏中使用的.sht文件的工具
原版：https://priw8.github.io/sht-webedit/
汉化版：

### 支持的游戏
- TH07 东方妖妖梦
- TH08 东方永夜抄  
- TH09 东方花映冢  
- TH10 东方风神录  
- TH11 东方地灵殿  
- TH12 东方星莲船  
- TH12.8 妖精大战争  
- TH13 东方神灵庙  
- TH14 东方辉针城  
- TH14.3 弹幕天邪鬼  
- TH15 东方绀珠传  
- TH16 东方天空璋  
- TH16.5 东方秘封噩梦日记  
- TH17 东方鬼形兽  
- TH18 东方虹龙洞  
- 黄昏酒場 (alcostg)  

本工具将持续更新以支持更多游戏。

### 功能特性
- 将.sht文件数据加载至可编辑表格
- 自由修改射击组设置
- 导出编辑后的数据回.sht文件
- 便捷工具（用于执行JS代码的控制台，弧度↔角度转换器等）

### TODO
- 查明未知数值的作用

## .sht文件工作原理
### TH10+系列
文件结构包含头部（"主表"）存储基本信息。头部之后是各灵力等级（灵力等级=子机数量）的子机位置数据。接着是射击组偏移数组，记录射击组在数组中的偏移量。射击组数组紧接其后，由以4个FF字节分隔的射击组构成。例如最大灵力等级为4时，应有10个射击组——5组高速射击和5组低速射击（游戏中虽然灵力从1开始，但0级射击组确实存在，如秘封噩梦日记中冈师傅最终战使用）。特殊情况可能包含更多射击组（如神灵庙的凭依模式）。每个射击组包含多个发射器（shooter），发射器控制单发子弹的属性和发射频率。若需子机同时发射2发子弹，需分配至2个发射器。

### TH07、TH08系列（TH06无.sht文件，射击数据可能硬编码）
与TH10+差异较大。最显著的是没有子机位置（子机逻辑可能硬编码），且文件本身不区分低速/高速状态——每个自机类型有2个.sht文件。此外包含更多可调参数（如收取点高度）。灵力等级系统也不同，.sht文件直接控制射击组切换条件，最多支持129个灵力等级（0-128）。

## 简要使用说明
**主表参数**
- *_u - 未使用字段（改了也没用）
- sht_off_cnt - 射击组偏移数组长度（有待发掘）
- 高速/低速_直向/斜向移速 - 移动时的直线/斜向速度（高速/低速）
- 最大power - 最大灵力等级（改了也不一定有用）
- SA_power_divisor - 仅地灵殿有效，设置每个灵力道具提供的灵力值（单道具灵力值=100/该参数）
- 帧伤上限 - 单帧对单个实体的最大伤害（含炸弹）

**子机位置**
（我觉得不需要解释）
子机位置是根据角色位置为基础而设定的偏移量，正坐标是往下，负坐标是往上。

**射击组偏移表**
导出时会自动重新计算偏移量，通常无需手动修改

**射击组数组表**
包含各灵力等级的低速/高速射击组。"其他配置"部分存放特殊射击组（如神灵庙的凭依模式）

**发射器参数**
- 发射间隔 - 子弹发射间隔（详见下文）
- 发射延迟 - 按下射击键后的激活延迟
- 偏移x/y - 子弹生成点相对于精灵的坐标偏移
- 判定a/b - 子弹判定框（原为x和y，因为我用luastg用的）
- 角度 - 子弹发射角度（弧度制顺时针，0度为正右方向）
- 弹速 - 子弹速度  
- 绑定子机 - 所属子机编号（0=主机，子季节子机编号加100）
- 纹理ID - 子弹动画脚本
- 击中纹理ID - 命中动画脚本
- 音效ID - 发射音效ID
- 发射间隔2/发射延迟2 - 见下文
- 初始/每帧/渲染/击中 效果 - 硬编码行为函数索引（如追踪、范围伤害等），各作函数不同
- flags - 未明标识位

**关于发射间隔的补充说明**
- 妖妖梦：使用60帧计时器，建议选择能被60整除的间隔
- 永夜抄～辉针城（除风神录）：使用15帧计时器，建议间隔为1/3/5/15
- 风神录：使用16帧计时器，建议间隔为1/2/4/8/16
- 绀珠传及后续作品：保留15帧计时字段，新增 发射间隔2/发射延迟2 使用120帧计时器（启用时优先于原字段）。使用该系统的射击可能出现停射BUG
